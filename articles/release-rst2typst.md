---
title: "reStructuredTextからTypst経由でPDFを出力したい（のでライブラリを作る）"
emoji: "📊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["restructuredtext", "typst"]
published: false
# published_at: 2026-02-27 23:00
---

## 技術同人誌を書く環境あれこれ

技術同人誌を書くアプローチは、様々な手法があります。

シンプルな手法だとMicrosoft Wordを初めとしたワープロソフト、真逆のデザイン志向に全振りするとAdobe InDesignなどがあります。 [^1]
技術書典などで見かけるものとしては、プレーンテキストをベースに執筆を進める[Re:VIEW](https://reviewml.org/ja/)などもあります。

[^1]: https://youtu.be/MmP5zbMjvNI?list=PLKtI82pFM8xAs2jfT0UqxJhXFsS33n6xM&t=2320

さて、自分は技術書典向けに出してみた同人誌が1冊+αあります。 [^2]
これらは、Sphinxの`latexpdf`ビルダーを用いたもので、「reStructuredText（以下"reST"と省略）で原稿を書きつつGitHub Actions上でPDFを生成する」というRe:VIEWに近いアプローチを取っています。

[^2]: 通常の頒布本を1冊と、企画倒れにならないように出したサンプル版が1冊。

この手法は普段ドキュメントHTMLのために使っていた文法やライブラリをそのまま電子書籍へ転用できます。
そのため「ドキュメントをSphinxを使って書く」という人にとっては、有力な選択肢の1つとなります。

一方で`latexpdf`ビルダーを使っていると、ちょっとした不満点があります。
このビルダーは名前の通り「一度LaTeXフォーマットへ出力した後にLaTeXコードからPDFを生成する」という動作をします。
そのため、次のような（自分にとっての）難点を抱えています。

<!-- textlint-disable -->

* LaTeX環境のセットアップコストがそれなりに高い。（時間的にも容量的にも）  
* そもそもTeXフォーマットへの習熟がある程度必要となる。
* レイアウト周りなどの調整時に、Sphinxに同梱されているテンプレートの構造を追う必要がある。

<!-- textlint-enable -->

## LaTeXの代替手段を探す

そんなわけでLaTeXに代わる組版を探していたのですが、目をつけたのがTypstです。

https://typst.app

[日本語化されたドキュメント](https://typst-jp.github.io/docs/)があるので細かくはこちらを見てもらうとして、大まかには次のような特徴を持っていると考えてもらえばよいです。

* 簡素（よく言えばシンプル）なマークアップ言語を提供。
* サイズ等が軽量で比較的高速に動作するコンパイラー。
* 比較的わかりやすく導入可能なライブラリ群。

LaTeXの置き換えを目標にしており、文法を抑えておけばこれだけで技術同人誌を書くのは困りません。
主要なIDEには執筆をサポートする拡張が存在するため、気になる人は試してみるとよいでしょう。

## それでもSphinxで執筆したい

とはいえ、個人的にはあくまでSphinx（reST）で執筆をしたいと思っています。
現時点で取り上げられる理由としては、次のような部分がそうです。

* リフロー版として、同じソースからPDFとEPUBを同時に生成したい。
* あくまで「組版のための命令」であるTypst言語に対して、reSTは文書の構造化へのウェイトが大きく文書の執筆向き。
* docutils/Sphinxのディレクティブを使ってソースを書きたい。

しかし、Sphinx本体にもSphinxの主要な拡張にも「Typstを使ってPDFを生成する」機能は存在しません。

### OSSの文化「ないなら…」

というわけで、「validなTypstコードを出力しつつPDFを出力する」機能を持つSphinx拡張を作ることにしました。

これ自体は2025年の夏頃に[atsphinx-typst](https://pypi.org/project/atsphinx-typst/)という名前でPyPI上にアップロードしています。
しかし、しばらく間があったのと、別件で作っていたライブラリの思想に寄せるアプローチを取り、**「docutilsの拡張機能としてreSTからTypstコードを出力する」**部分に特化したライブラリを別途作ることにしました。 [^3]

[^3]: これは、docutilsとSphinxの担当領域を踏まえて、「Typstへの変換」「関連リソースの調停」という枠組みに拡張側を分割することにしたためです。

## rst2typstの紹介

ここからが本題となるライブラリの紹介です。名前は**rst2typst**となります。
これはdocutils同梱のCLIコマンドの名称に揃えた形式となっています。

https://pypi.org/project/rst2typst/

基本的な役割は前章で書いた通り「reST（をパースして出来たDocTree）からTypstコードを生成する」ことに特化しています。
優先順位を「自分が技術書を執筆するときに必要な文法」に注力して、現時点でも単体のreSTから電子書籍っぽいPDFを生成するところまでは動作します。

## rst2typstの使い方

### インストール

### ドキュメントを書く

### 2パターンのビルド

## おわりに

というわけで、rst2typstの紹介をしてみました。
冒頭にちょっと触れた技術書典で頒布する予定のものがあり、今回はこのrst2typstかatsphinx-typstで作業をする予定でいます。
無事に1冊書けそうだったら、その顛末をまた技術同人誌にしてみようと考えています。

## 以下、余談

### `raw`ディレクティブと`--template`オプションというワイルドカード

この記事を書いた時点でのバージョンはv0.1.0なのですが、強い意思を持って「v0.1.0の時点で実装する」と決めた機能が2つあります。
それが、ここのタイトルでもある「`raw`ディレクティブ」と「CLIの`--template`オプション」です。
